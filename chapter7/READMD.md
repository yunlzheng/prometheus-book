# 第7章 集群与高可用

Prometheus内置了一个基于本地存储的时间序列数据库，在Promtheus设计上使用本地存储可以降低Prometheus部署和管理的复杂度，避免了HA的复杂性。 在默认情况下，用户只需要部署多套Promtheus，采集相同的Targets即可实现基本的HA。同时由于Promethus高效的数据处理能力，单个Prometheus Server基本上能够应对大部分用户监控规模的需求。

当然本地存储也带来了一些不好的地方，首先就是数据持久化的问题，特别是在像Kubernetes这样的动态集群环境下，如果Promthues的实例被重新调度，那所有历史监控数据都会丢失。其次本地存储也意味着Prometheus不适合保存大量历史数据(一般推荐几周或者几个月)。最后本地存储也导致Prometheus无法进行弹性扩展。为了适应这方面的需求，Prometheus提供了remote_write和remote_read的特性，支持将数据存储到远端和从远端读取数据。通过将监控与数据分离，Promtheus能够更好的进行弹性扩展。

除了本地存储方面的问题，由于Promtheus基于Pull模型，当有大量的Target需要采样本时，单独Promtheus数据抓取可能会出现一些性能问题，联邦集群的特性可以让Promtheus将样本采集任务划分到不同的Prometheus实例中，并且通过一个统一的中心节点进行聚合。从而可以使Promtheuse可以根据规模进行扩展。

除了讨论Prometheus自身的高可用，Alertmanager作为Promthues体系中的告警处理中心，本章的最后部分会讨论如何实现Alertmanager的高可用部署。

本章的主要内容：
* Promtheus本地存储机制
* Promtheus的远程存储机制
* Promtheus联邦集群
* Promtheus高可用部署架构
* Alertmanager高可用部署架构
